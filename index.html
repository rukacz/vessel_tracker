<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sledování lodí a stavu zásob</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
            color: #333;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background-color: #1a4f8a;
            color: white;
            padding: 1rem;
            text-align: center;
            margin-bottom: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        header h1 {
            margin: 0;
        }
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .map-container {
            flex: 1 1 700px;
        }
        .inventory-container {
            flex: 1 1 400px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
        }
        #map {
            height: 600px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .dashboard {
            margin-top: 20px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
        }
        .vessel-info {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        .vessel-card {
            flex: 1 1 300px;
            background-color: #f9f9f9;
            border-left: 5px solid #1a4f8a;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .vessel-card h3 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #1a4f8a;
        }
        .vessel-card p {
            margin: 5px 0;
        }
        .vessel-card.flamingo { border-left-color: #ff7043; }
        .vessel-card.pelikan { border-left-color: #42a5f5; }
        .vessel-card.harmony { border-left-color: #66bb6a; }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table th {
            background-color: #f2f2f2;
            padding: 10px;
            text-align: left;
            border-bottom: 2px solid #ddd;
        }
        table td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        .status-low {
            color: #f44336;
            font-weight: bold;
        }
        .status-medium {
            color: #ff9800;
        }
        .status-high {
            color: #4caf50;
        }
        .update-info {
            margin-top: 10px;
            text-align: right;
            font-size: 0.8rem;
            color: #666;
        }
        .vessel-info {
            margin-bottom: 15px;
        }
        .loading {
            text-align: center;
            padding: 20px;
            font-style: italic;
            color: #666;
        }
        .error-message {
            background-color: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            text-align: center;
        }
        @media (max-width: 768px) {
            .vessel-card {
                flex: 1 1 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Sledování lodí a stavu zásob</h1>
        </header>
        
        <div class="main-content">
            <div class="map-container">
                <div id="map"></div>
                
                <div class="dashboard">
                    <h2>Aktuální poloha lodí</h2>
                    <div class="vessel-info">
                        <div class="vessel-card flamingo">
                            <h3>FLAMINGO 1</h3>
                            <p id="flamingo-1-position">Pozice: Načítání...</p>
                            <p id="flamingo-1-status">Status: Načítání...</p>
                            <p id="flamingo-1-destination">Cíl: Načítání...</p>
                            <p id="flamingo-1-eta">ETA: Načítání...</p>
                        </div>
                        
                        <div class="vessel-card pelikan">
                            <h3>PELIKAN</h3>
                            <p id="pelikan-position">Pozice: Načítání...</p>
                            <p id="pelikan-status">Status: Načítání...</p>
                            <p id="pelikan-destination">Cíl: Načítání...</p>
                            <p id="pelikan-eta">ETA: Načítání...</p>
                        </div>
                        
                        <div class="vessel-card harmony">
                            <h3>HARMONY</h3>
                            <p id="harmony-position">Pozice: Načítání...</p>
                            <p id="harmony-status">Status: Načítání...</p>
                            <p id="harmony-destination">Cíl: Načítání...</p>
                            <p id="harmony-eta">ETA: Načítání...</p>
                        </div>
                    </div>
                    <div class="update-info" id="last-update">
                        Poslední aktualizace: --
                    </div>
                </div>
            </div>
            
            <div class="inventory-container">
                <h2>Stav zásob a dodávky</h2>
                
                <div id="inventory-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Produkt</th>
                                <th>Aktuální stav</th>
                                <th>Očekáváno</th>
                                <th>Loď</th>
                                <th>Datum dodání</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-data">
                            <tr>
                                <td colspan="5" class="loading">Načítání dat...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script>
        // Počkáme, až se celý dokument načte
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Dokument je načten, inicializuji aplikaci...');
            
            // Konfigurace sledovaných lodí
            const vessels = [
                { name: 'FLAMINGO 1', imo: '9474199', mmsi: '352002503', color: '#ff7043' },
                { name: 'PELIKAN', imo: '9474280', mmsi: '352003347', color: '#42a5f5' },
                { name: 'HARMONY', imo: '9449522', mmsi: '352003307', color: '#66bb6a' }
            ];

            // Inicializace mapy
            const map = L.map('map').setView([40, 20], 5);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            // Objekty pro markery lodí
            const vesselMarkers = {};
            const vesselData = {};

            // Simulace dat o zásobách
            const inventoryData = [
                { id: 1, name: 'Pšenice', current: 1200, unit: 't', expected: 5000, source: 'FLAMINGO 1', delivery: '15.5.2025', status: 'medium' },
                { id: 2, name: 'Kukuřice', current: 350, unit: 't', expected: 3000, source: 'PELIKAN', delivery: '22.5.2025', status: 'low' },
                { id: 3, name: 'Rýže', current: 2500, unit: 't', expected: 1800, source: 'HARMONY', delivery: '18.5.2025', status: 'high' },
                { id: 4, name: 'Sojové boby', current: 680, unit: 't', expected: 2200, source: 'FLAMINGO 1', delivery: '15.5.2025', status: 'medium' },
                { id: 5, name: 'Slunečnice', current: 220, unit: 't', expected: 1500, source: 'PELIKAN', delivery: '22.5.2025', status: 'low' },
                { id: 6, name: 'Ječmen', current: 1800, unit: 't', expected: 1000, source: 'HARMONY', delivery: '18.5.2025', status: 'high' }
            ];

            // Funkce pro aktualizaci tabulky zásob
            function updateInventoryTable() {
                console.log('Aktualizuji tabulku zásob...');
                const tableBody = document.getElementById('inventory-data');
                if (!tableBody) {
                    console.error('Element inventory-data nenalezen!');
                    return;
                }
                tableBody.innerHTML = '';
                
                inventoryData.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.name}</td>
                        <td class="status-${item.status}">${item.current} ${item.unit}</td>
                        <td>${item.expected} ${item.unit}</td>
                        <td>${item.source}</td>
                        <td>${item.delivery}</td>
                    `;
                    tableBody.appendChild(row);
                });
            }

            // Funkce pro aktualizaci informací o lodích
            function updateVesselInfo(data) {
                console.log('Aktualizuji informace o lodích...');
                data.forEach(vessel => {
                    vesselData[vessel.name] = vessel;
                    
                    const nameForId = vessel.name.toLowerCase().replace(/ /g, '-');
                    
                    // Aktualizace informací v kartách - kontrolujeme existenci elementů
                    const positionElement = document.getElementById(`${nameForId}-position`);
                    const statusElement = document.getElementById(`${nameForId}-status`);
                    const destinationElement = document.getElementById(`${nameForId}-destination`);
                    const etaElement = document.getElementById(`${nameForId}-eta`);
                    
                    if (positionElement) {
                        if (vessel.position && vessel.position.lat && vessel.position.lon) {
                            positionElement.textContent = `Pozice: ${parseFloat(vessel.position.lat).toFixed(4)}° N, ${parseFloat(vessel.position.lon).toFixed(4)}° E`;
                        } else {
                            positionElement.textContent = `Pozice: Neznámá`;
                        }
                    }
                    
                    if (statusElement) {
                        statusElement.textContent = `Status: ${vessel.status || 'Neznámý'}`;
                    }
                    
                    if (destinationElement) {
                        destinationElement.textContent = `Cíl: ${vessel.destination || 'Neznámý'}`;
                    }
                    
                    if (etaElement) {
                        etaElement.textContent = `ETA: ${vessel.eta || 'Nedostupné'}`;
                    }
                });
            }

// Funkce pro aktualizaci pozic na mapě s opravou pro bounds.isEmpty
function updateMap(data) {
    console.log('Aktualizuji pozice na mapě...');
    
    // Vytvoření hranice pro zoom - oprava chyby bounds.isEmpty
    const bounds = L.latLngBounds();
    let hasValidPositions = false;  // Příznak, zda máme alespoň jednu platnou pozici
    
    data.forEach(vessel => {
        const { lat, lon } = vessel.position || {};
        if (!lat || !lon) return;
        
        const position = L.latLng(parseFloat(lat), parseFloat(lon));
        bounds.extend(position);
        hasValidPositions = true;  // Našli jsme alespoň jednu platnou pozici
        
        // Vyhledání konfigurace pro tuto loď
        const vesselConfig = vessels.find(v => v.name === vessel.name) || 
                             { color: '#1a4f8a' };  // Výchozí barva, pokud konfigurace není nalezena
        
        // Pokud již existuje marker, aktualizujeme jeho pozici
        if (vesselMarkers[vessel.name]) {
            vesselMarkers[vessel.name].setLatLng(position);
        } else {
            // Jinak vytvoříme nový marker
            const shipIcon = L.divIcon({
                html: `<div style="color: ${vesselConfig.color}; font-size: 24px;">⚓</div>`,
                className: 'ship-marker',
                iconSize: [30, 30],
                iconAnchor: [15, 15]
            });
            
            const marker = L.marker(position, { icon: shipIcon })
                .addTo(map)
                .bindPopup(`
                    <div class="popup-content">
                        <h3>${vessel.name}</h3>
                        <p>IMO: ${vessel.imo}</p>
                        <p>Status: ${vessel.status || 'Neznámý'}</p>
                        <p>Cíl: ${vessel.destination || 'Neznámý'}</p>
                        <p>ETA: ${vessel.eta || 'Nedostupné'}</p>
                        <p>Kurz/Rychlost: ${vessel.course || 'Nedostupné'}</p>
                    </div>
                `);
            
            vesselMarkers[vessel.name] = marker;
        }
    });
    
    // Přiblížení mapy na všechny lodě - oprava chyby bounds.isEmpty
    if (hasValidPositions) {
        try {
            map.fitBounds(bounds, { padding: [50, 50] });
        } catch (error) {
            console.error('Chyba při nastavování hranic mapy:', error);
            // Záložní řešení - nastavíme výchozí pohled na mapu
            map.setView([40, 20], 5);
        }
    }
}

            // Funkce pro načítání dat lodí - POUŽIJE STATICKÁ DATA
            function loadVesselData() {
                try {
                    console.log('Načítám statická data o lodích...');
                    
                    // Statická data o lodích
                    const data = [
                        {
                            name: 'FLAMINGO 1',
                            imo: '9474199',
                            mmsi: '352002503',
                            position: { lat: 35.4562, lon: 24.8721 },
                            status: 'Underway using engine',
                            destination: 'Koper, Slovenia',
                            eta: '2025-05-15 08:30',
                            course: '245° / 12.5 kn',
                            lastUpdate: '2025-04-26T09:15:23Z'
                        },
                        {
                            name: 'PELIKAN',
                            imo: '9474280',
                            mmsi: '352003347',
                            position: { lat: 41.9812, lon: 19.3742 },
                            status: 'Underway using engine',
                            destination: 'Rijeka, Croatia',
                            eta: '2025-05-22 13:45',
                            course: '320° / 10.2 kn',
                            lastUpdate: '2025-04-26T09:15:23Z'
                        },
                        {
                            name: 'HARMONY',
                            imo: '9449522',
                            mmsi: '352003307',
                            position: { lat: 44.3642, lon: 33.7923 },
                            status: 'Underway using engine',
                            destination: 'Constanta, Romania',
                            eta: '2025-05-18 22:15',
                            course: '190° / 11.7 kn',
                            lastUpdate: '2025-04-26T09:15:23Z'
                        }
                    ];
                    
                    // Aktualizace dat a mapy
                    updateVesselInfo(data);
                    updateMap(data);
                    
                    // Aktualizace času poslední aktualizace
                    const lastUpdateElement = document.getElementById('last-update');
                    if (lastUpdateElement) {
                        const updateDate = new Date();
                        lastUpdateElement.textContent = `Poslední aktualizace: ${updateDate.toLocaleString('cs-CZ')}`;
                    }
                    
                    return true;
                } catch (error) {
                    console.error('Chyba při načítání dat lodí:', error);
                    return false;
                }
            }

            // Inicializace a načtení dat
            console.log('Spouštím inicializaci dat...');
            updateInventoryTable();
            loadVesselData();
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sledování lodí a stavu zásob</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
            color: #333;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background-color: #1a4f8a;
            color: white;
            padding: 1rem;
            text-align: center;
            margin-bottom: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        header h1 {
            margin: 0;
        }
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .map-container {
            flex: 1 1 700px;
        }
        .inventory-container {
            flex: 1 1 400px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
        }
        #map {
            height: 600px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .dashboard {
            margin-top: 20px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
        }
        .vessel-info {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        .vessel-card {
            flex: 1 1 300px;
            background-color: #f9f9f9;
            border-left: 5px solid #1a4f8a;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .vessel-card h3 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #1a4f8a;
        }
        .vessel-card p {
            margin: 5px 0;
        }
        .vessel-card.flamingo { border-left-color: #ff7043; }
        .vessel-card.pelikan { border-left-color: #42a5f5; }
        .vessel-card.harmony { border-left-color: #66bb6a; }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table th {
            background-color: #f2f2f2;
            padding: 10px;
            text-align: left;
            border-bottom: 2px solid #ddd;
        }
        table td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        .status-low {
            color: #f44336;
            font-weight: bold;
        }
        .status-medium {
            color: #ff9800;
        }
        .status-high {
            color: #4caf50;
        }
        .update-info {
            margin-top: 10px;
            text-align: right;
            font-size: 0.8rem;
            color: #666;
        }
        .vessel-info {
            margin-bottom: 15px;
        }
        .loading {
            text-align: center;
            padding: 20px;
            font-style: italic;
            color: #666;
        }
        .error-message {
            background-color: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            text-align: center;
        }
        @media (max-width: 768px) {
            .vessel-card {
                flex: 1 1 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Sledování lodí a stavu zásob</h1>
        </header>
        
        <div class="main-content">
            <div class="map-container">
                <div id="map"></div>
                
                <div class="dashboard">
                    <h2>Aktuální poloha lodí</h2>
                    <div class="vessel-info">
                        <div class="vessel-card flamingo">
                            <h3>FLAMINGO 1</h3>
                            <p id="flamingo-position">Pozice: Načítání...</p>
                            <p id="flamingo-status">Status: Načítání...</p>
                            <p id="flamingo-destination">Cíl: Načítání...</p>
                            <p id="flamingo-eta">ETA: Načítání...</p>
                        </div>
                        
                        <div class="vessel-card pelikan">
                            <h3>PELIKAN</h3>
                            <p id="pelikan-position">Pozice: Načítání...</p>
                            <p id="pelikan-status">Status: Načítání...</p>
                            <p id="pelikan-destination">Cíl: Načítání...</p>
                            <p id="pelikan-eta">ETA: Načítání...</p>
                        </div>
                        
                        <div class="vessel-card harmony">
                            <h3>HARMONY</h3>
                            <p id="harmony-position">Pozice: Načítání...</p>
                            <p id="harmony-status">Status: Načítání...</p>
                            <p id="harmony-destination">Cíl: Načítání...</p>
                            <p id="harmony-eta">ETA: Načítání...</p>
                        </div>
                    </div>
                    <div class="update-info" id="last-update">
                        Poslední aktualizace: Načítání...
                    </div>
                </div>
            </div>
            
            <div class="inventory-container">
                <h2>Stav zásob a dodávky</h2>
                
                <!-- Odkaz na správu zásob pomocí Google Sheets -->
                <p>
                    <a href="#" id="inventory-link" target="_blank">Upravit zásoby v Google Sheets</a>
                    (pro přístup je nutné mít oprávnění)
                </p>
                
                <div id="inventory-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Produkt</th>
                                <th>Aktuální stav</th>
                                <th>Očekáváno</th>
                                <th>Loď</th>
                                <th>Datum dodání</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-data">
                            <tr>
                                <td colspan="5" class="loading">Načítání dat...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script>
        // Konfigurace sledovaných lodí
        const vessels = [
            { name: 'FLAMINGO 1', imo: '9474199', mmsi: '352002503', color: '#ff7043' },
            { name: 'PELIKAN', imo: '9474280', mmsi: '352003347', color: '#42a5f5' },
            { name: 'HARMONY', imo: '9449522', mmsi: '352003307', color: '#66bb6a' }
        ];

        // Konfigurace zdrojů dat
        const config = {
            // ZMĚŇTE TYTO HODNOTY podle vaší konfigurace
            dataSource: 'github',
            githubUser: 'rukacz',  // Vaše uživatelské jméno
            githubRepo: 'vessel_tracker',  // Název vašeho repozitáře
            
            // Pro JSONBin.io
            jsonbinCurrentId: 'VAS_CURRENT_BIN_ID',
            
            // Pro Google Sheets (správa zásob)
            googleSheetId: 'VAS_GOOGLE_SHEET_ID',
            googleSheetTab: 'inventory'
        };

        // Inicializace mapy
        const map = L.map('map').setView([0, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Objekty pro markery lodí
        const vesselMarkers = {};
        const vesselData = {};

        // Nastavení odkazu na Google Sheets
        document.getElementById('inventory-link').href = 
            `https://docs.google.com/spreadsheets/d/${config.googleSheetId}/edit#gid=0`;

// Funkce pro načtení dat lodí podle konfigurace
async function loadVesselData() {
    try {
        let data;
        
        if (config.dataSource === 'github') {
            // Načtení dat z GitHub Pages - opravená cesta k souborům
            const url = `https://${config.githubUser}.github.io/${config.githubRepo}/public/current_vessels.json`;
            console.log('Načítám data z URL:', url);
            
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            data = await response.json();
            console.log('Načtená data:', data);
        } 
        else if (config.dataSource === 'jsonbin') {
            // Načtení dat z JSONBin.io (veřejné API)
            const response = await fetch(`https://api.jsonbin.io/v3/b/${config.jsonbinCurrentId}/latest`);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            const result = await response.json();
            data = result.record;
        }
        else {
            // Pro účely testování použijeme simulovaná data
            data = [
                {
                    name: 'FLAMINGO 1',
                    imo: '9474199',
                    mmsi: '352002503',
                    position: { lat: 35.4562, lon: 24.8721 },
                    status: 'Underway using engine',
                    destination: 'Koper, Slovenia',
                    eta: '2025-05-15 08:30',
                    course: '245° / 12.5 kn',
                    lastUpdate: '2025-04-25T09:15:23Z'
                },
                {
                    name: 'PELIKAN',
                    imo: '9474280',
                    mmsi: '352003347',
                    position: { lat: 41.9812, lon: 19.3742 },
                    status: 'Underway using engine',
                    destination: 'Rijeka, Croatia',
                    eta: '2025-05-22 13:45',
                    course: '320° / 10.2 kn',
                    lastUpdate: '2025-04-25T09:15:23Z'
                },
                {
                    name: 'HARMONY',
                    imo: '9449522',
                    mmsi: '352003307',
                    position: { lat: 44.3642, lon: 33.7923 },
                    status: 'Underway using engine',
                    destination: 'Constanta, Romania',
                    eta: '2025-05-18 22:15',
                    course: '190° / 11.7 kn',
                    lastUpdate: '2025-04-25T09:15:23Z'
                }
            ];
        }
        
        // Aktualizace dat a mapy
        updateVesselInfo(data);
        updateMap(data);
        
        // Aktualizace času poslední aktualizace
        const lastUpdateElement = document.getElementById('last-update');
        const updateDate = new Date(data[0].lastUpdate);
        lastUpdateElement.textContent = `Poslední aktualizace: ${updateDate.toLocaleString('cs-CZ')}`;
        
        return true;
    } catch (error) {
        console.error('Chyba při načítání dat lodí:', error);
        
        // Zobrazení chybové zprávy uživateli
        const mapContainer = document.querySelector('.map-container');
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error-message';
        errorDiv.textContent = `Nepodařilo se načíst aktuální data lodí. Zkuste to prosím později. (${error.message})`;
        mapContainer.insertBefore(errorDiv, mapContainer.firstChild);
        
        // Použijeme záložní data
        const fallbackData = [
            {
                name: 'FLAMINGO 1',
                imo: '9474199',
                mmsi: '352002503',
                position: { lat: 35.4562, lon: 24.8721 },
                status: 'Underway using engine',
                destination: 'Koper, Slovenia',
                eta: '2025-05-15 08:30',
                course: '245° / 12.5 kn',
                lastUpdate: '2025-04-25T09:15:23Z'
            },
            {
                name: 'PELIKAN',
                imo: '9474280',
                mmsi: '352003347',
                position: { lat: 41.9812, lon: 19.3742 },
                status: 'Underway using engine',
                destination: 'Rijeka, Croatia',
                eta: '2025-05-22 13:45',
                course: '320° / 10.2 kn',
                lastUpdate: '2025-04-25T09:15:23Z'
            },
            {
                name: 'HARMONY',
                imo: '9449522',
                mmsi: '352003307',
                position: { lat: 44.3642, lon: 33.7923 },
                status: 'Underway using engine',
                destination: 'Constanta, Romania',
                eta: '2025-05-18 22:15',
                course: '190° / 11.7 kn',
                lastUpdate: '2025-04-25T09:15:23Z'
            }
        ];
        
        updateVesselInfo(fallbackData);
        updateMap(fallbackData);
        
        return false;
    }
}

        // Funkce pro načtení dat o zásobách z Google Sheets
        async function loadInventoryData() {
            try {
                // Publikovaný Google Sheet jako CSV
                const sheetUrl = `https://docs.google.com/spreadsheets/d/${config.googleSheetId}/gviz/tq?tqx=out:csv&sheet=${config.googleSheetTab}`;
                
                const response = await fetch(sheetUrl);
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                
                const csvText = await response.text();
                const parsedData = parseCSV(csvText);
                
                updateInventoryTable(parsedData);
                return true;
            } catch (error) {
                console.error('Chyba při načítání zásob:', error);
                
                // Pokud se nepodaří načíst data z Google Sheets, použijeme simulovaná data
                const demoData = [
                    { name: 'Pšenice', current: 1200, unit: 't', expected: 5000, source: 'FLAMINGO 1', delivery: '15.5.2025', status: 'medium' },
                    { name: 'Kukuřice', current: 350, unit: 't', expected: 3000, source: 'PELIKAN', delivery: '22.5.2025', status: 'low' },
                    { name: 'Rýže', current: 2500, unit: 't', expected: 1800, source: 'HARMONY', delivery: '18.5.2025', status: 'high' },
                    { name: 'Sojové boby', current: 680, unit: 't', expected: 2200, source: 'FLAMINGO 1', delivery: '15.5.2025', status: 'medium' },
                    { name: 'Slunečnice', current: 220, unit: 't', expected: 1500, source: 'PELIKAN', delivery:
